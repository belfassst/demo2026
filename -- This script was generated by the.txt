-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.address
(
    id serial NOT NULL,
    name_address character varying(255) COLLATE pg_catalog."default",
    CONSTRAINT address_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.category
(
    id serial NOT NULL,
    category_pk character varying(155) COLLATE pg_catalog."default",
    CONSTRAINT category_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.name_tovar
(
    id serial NOT NULL,
    name_tovar_pk character varying(155) COLLATE pg_catalog."default",
    CONSTRAINT name_tovar_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.postavshik
(
    id serial NOT NULL,
    postavshik_pk character varying(155) COLLATE pg_catalog."default",
    CONSTRAINT postavshik_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.proizvoditel
(
    id serial NOT NULL,
    proizvoditel_pk character varying(155) COLLATE pg_catalog."default",
    CONSTRAINT proizvoditel_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.roles
(
    id serial NOT NULL,
    role_name character varying(155) COLLATE pg_catalog."default",
    CONSTRAINT roles_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.status_zakaza
(
    id serial NOT NULL,
    status_zakaza character varying(155) COLLATE pg_catalog."default",
    CONSTRAINT status_zakaza_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.tovar
(
    id_article character varying(155) COLLATE pg_catalog."default" NOT NULL,
    name_tovar_fk integer,
    ed_izm character varying(15) COLLATE pg_catalog."default",
    price bigint,
    postavshik_fk integer,
    proizvoditel_fk integer,
    category_fk integer,
    discount integer,
    kolichestvo integer,
    opisanie character varying(255) COLLATE pg_catalog."default",
    picture character varying(155) COLLATE pg_catalog."default",
    CONSTRAINT tovar_pkey PRIMARY KEY (id_article)
);

CREATE TABLE IF NOT EXISTS public.users
(
    id serial NOT NULL,
    role_fk integer,
    fio character varying(155) COLLATE pg_catalog."default",
    login character varying(155) COLLATE pg_catalog."default",
    password character varying(155) COLLATE pg_catalog."default",
    CONSTRAINT users_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.zakaz
(
    nomer_zakaza_pk serial NOT NULL,
    data_zakaza date,
    data_dostavki date,
    address_fk integer,
    fio_users_fk integer,
    code integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 911 MINVALUE 901 MAXVALUE 2147483647 CACHE 1 ),
    status_zakaza_fk integer,
    CONSTRAINT zakaz_pkey PRIMARY KEY (nomer_zakaza_pk)
);

CREATE TABLE IF NOT EXISTS public.zakaz_tovar
(
    id serial NOT NULL,
    nomer_zakaza_fk integer,
    article_fk character varying(155) COLLATE pg_catalog."default",
    quantity integer,
    CONSTRAINT zakaz_tovar_pkey PRIMARY KEY (id)
);

ALTER TABLE IF EXISTS public.tovar
    ADD CONSTRAINT tovar_category_fk_fkey FOREIGN KEY (category_fk)
    REFERENCES public.category (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.tovar
    ADD CONSTRAINT tovar_name_tovar_fk_fkey FOREIGN KEY (name_tovar_fk)
    REFERENCES public.name_tovar (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.tovar
    ADD CONSTRAINT tovar_postavshik_fk_fkey FOREIGN KEY (postavshik_fk)
    REFERENCES public.postavshik (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.tovar
    ADD CONSTRAINT tovar_proizvoditel_fk_fkey FOREIGN KEY (proizvoditel_fk)
    REFERENCES public.proizvoditel (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.users
    ADD CONSTRAINT users_role_fk_fkey FOREIGN KEY (role_fk)
    REFERENCES public.roles (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.zakaz
    ADD CONSTRAINT zakaz_address_fk_fkey FOREIGN KEY (address_fk)
    REFERENCES public.address (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.zakaz
    ADD CONSTRAINT zakaz_fio_users_fk_fkey FOREIGN KEY (fio_users_fk)
    REFERENCES public.users (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.zakaz
    ADD CONSTRAINT zakaz_status_zakaza_fk_fkey FOREIGN KEY (status_zakaza_fk)
    REFERENCES public.status_zakaza (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.zakaz_tovar
    ADD CONSTRAINT zakaz_tovar_article_fk_fkey FOREIGN KEY (article_fk)
    REFERENCES public.tovar (id_article) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.zakaz_tovar
    ADD CONSTRAINT zakaz_tovar_nomer_zakaza_fk_fkey FOREIGN KEY (nomer_zakaza_fk)
    REFERENCES public.zakaz (nomer_zakaza_pk) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;

END;